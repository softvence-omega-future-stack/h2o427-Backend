<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification System Test</title>
    <style>
        body {
            margin: 20px;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .box {
            border: 1px solid black;
            padding: 15px;
            margin-bottom: 20px;
        }
        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .col {
            flex: 1;
        }
        input, textarea, select {
            margin: 5px 0;
        }
        button {
            margin-top: 10px;
            padding: 5px 15px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        ul li {
            padding: 8px;
            border: 1px solid black;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Push Notification Test</h1>
    
    {% if messages %}
        <div class="box">
            {% for message in messages %}
                <p><strong>{{ message }}</strong></p>
            {% endfor %}
        </div>
    {% endif %}
    
    <div class="row">
        <div class="col">
            <div class="box">
                <h2>1. Register Device Token</h2>
                <form method="post" action="{% url 'notifications:test_register_device' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="register">
                    
                    <label>User ID:</label><br>
                    <input type="number" name="user_id" value="1" required><br>
                    
                    <label>Device Token:</label><br>
                    <input type="text" name="device_token" placeholder="Enter FCM device token" size="40" required><br>
                    
                    <label>Device Type:</label><br>
                    <select name="device_type">
                        <option value="android">Android</option>
                        <option value="ios">iOS</option>
                        <option value="web">Web</option>
                    </select><br>
                    
                    <button type="submit">Register Token</button>
                </form>
            </div>
        </div>
        
        <div class="col">
            <div class="box">
                <h2>2. Send Test Notification</h2>
                <form method="post" action="{% url 'notifications:test_send_notification' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="send">
                    
                    <label>User ID:</label><br>
                    <input type="number" name="user_id" value="1" required><br>
                    
                    <label>Title:</label><br>
                    <input type="text" name="title" value="Test Notification" size="40" required><br>
                    
                    <label>Message:</label><br>
                    <textarea name="message" rows="3" cols="40" required>This is a test notification from the notification system.</textarea><br>
                    
                    <label>Notification Type:</label><br>
                    <select name="notification_type">
                        <option value="general">General</option>
                        <option value="request_update">Request Update</option>
                        <option value="report_ready">Report Ready</option>
                        <option value="subscription">Subscription</option>
                        <option value="admin">Admin</option>
                    </select><br>
                    
                    <button type="submit">Send Notification</button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="box">
        <h2>3. View Notifications</h2>
        <form method="get" action="{% url 'notifications:test_view_notifications' %}">
            <label>User ID:</label>
            <input type="number" name="user_id" value="1" required>
            <button type="submit">Get Notifications</button>
        </form>
        
        {% if notifications %}
            <h3>Notifications:</h3>
            <ul>
                {% for notification in notifications %}
                    <li>
                        <strong>ID:</strong> {{ notification.id }} | 
                        <strong>Title:</strong> {{ notification.title }} | 
                        <strong>Message:</strong> {{ notification.message }} | 
                        <strong>Type:</strong> {{ notification.get_type_display }} | 
                        <strong>Category:</strong> {{ notification.get_category_display }} | 
                        <strong>Read:</strong> {% if notification.is_read %}Yes{% else %}No{% endif %} | 
                        <strong>Created:</strong> {{ notification.created_at }}
                        
                        {% if not notification.is_read %}
                            <form method="post" action="{% url 'notifications:test_mark_read' notification.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit">Mark as Read</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% elif request.GET.user_id %}
            <p>No notifications found for this user.</p>
        {% endif %}
    </div>
    
    <div class="box">
        <h2>4. All Registered Devices</h2>
        {% if devices %}
            <ul>
                {% for device in devices %}
                    <li>
                        <strong>User ID:</strong> {{ device.user_id }} | 
                        <strong>Device Type:</strong> {{ device.device_type }} | 
                        <strong>Token:</strong> {{ device.registration_token|truncatechars:50 }} | 
                        <strong>Active:</strong> {% if device.active %}Yes{% else %}No{% endif %} | 
                        <strong>Registered:</strong> {{ device.created_at }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No devices registered yet.</p>
        {% endif %}
    </div>
    
    </div>
</body>
</html>
